<div class="inventory-list-container fade-in">
  <div class="page-header">
    <div>
      <h1>Gestion du Stock</h1>
      <p class="subtitle">Surveillez et gérez votre inventaire</p>
    </div>
    <div class="header-actions">
      <a routerLink="/inventory/create" class="btn btn-secondary">
        <i class="bi bi-plus-lg"></i>
        Nouvel inventaire
      </a>
      <a routerLink="/inventory/movements" class="btn btn-primary">
        <i class="bi bi-arrow-left-right"></i>
        Mouvements
      </a>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card card">
      <div class="stat-icon total">
        <i class="bi bi-box-seam" style="font-size: 32px;"></i>
      </div>
      <div class="stat-content">
        <div class="stat-label">Total produits</div>
        <div class="stat-value">{{ totalProducts }}</div>
      </div>
    </div>

    <div class="stat-card card">
      <div class="stat-icon value">
        <i class="bi bi-currency-dollar" style="font-size: 32px;"></i>
      </div>
      <div class="stat-content">
        <div class="stat-label">Valeur totale</div>
        <div class="stat-value">{{ totalValue | currencyFormat }}</div>
      </div>
    </div>

    <div class="stat-card card">
      <div class="stat-icon warning">
        <i class="bi bi-exclamation-triangle" style="font-size: 32px;"></i>
      </div>
      <div class="stat-content">
        <div class="stat-label">Stock faible</div>
        <div class="stat-value">{{ lowStockCount }}</div>
      </div>
    </div>

    <div class="stat-card card">
      <div class="stat-icon danger">
        <i class="bi bi-x-circle" style="font-size: 32px;"></i>
      </div>
      <div class="stat-content">
        <div class="stat-label">Rupture de stock</div>
        <div class="stat-value">{{ outOfStockCount }}</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-card card">
    <div class="filters-grid">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input 
          type="text" 
          placeholder="Rechercher un produit..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        />
      </div>

      <select 
        [(ngModel)]="statusFilter" 
        (change)="onStatusFilterChange()"
        class="filter-select"
      >
        <option value="all">Tous les statuts</option>
        <option value="in_stock">En stock</option>
        <option value="low_stock">Stock faible</option>
        <option value="out_of_stock">Rupture de stock</option>
      </select>

      <select 
        [(ngModel)]="categoryFilter" 
        (change)="onCategoryFilterChange()"
        class="filter-select"
      >
        <option value="all">Toutes les catégories</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>

      <div class="filter-toggle">
        <label class="toggle-switch">
          <input 
            type="checkbox" 
            [(ngModel)]="showLowStockOnly"
            (change)="onLowStockToggle()"
          />
          <span class="toggle-slider"></span>
          <span class="toggle-label">Stock faible uniquement</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Inventory Table -->
  <div class="inventory-table card">
    <table>
      <thead>
        <tr>
          <th>Produit</th>
          <th>Catégorie</th>
          <th>Stock actuel</th>
          <th>Stock minimum</th>
          <th>Statut</th>
          <th>Prix</th>
          <th>Dernier mouvement</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of displayedInventories" 
            [class.low-stock-row]="item.is_low_stock" 
            [class.out-of-stock-row]="item.quantity === 0"
            class="inventory-row">
          <td>
            <div class="product-cell">
              <div class="product-name-row">
                <a [routerLink]="['/products/detail', item.product]" class="product-name-link">
                  <strong class="product-name">{{ item.product_name }}</strong>
                </a>
                <span class="product-sku" *ngIf="item.product_sku">{{ item.product_sku }}</span>
              </div>
              <div class="stock-indicator">
                <div class="stock-bar">
                  <div class="stock-bar-fill" 
                       [style.width.%]="getStockPercentage(item)" 
                       [class.low]="item.is_low_stock" 
                       [class.out]="item.quantity === 0"
                       [class.good]="!item.is_low_stock && item.quantity > 0">
                  </div>
                </div>
                <span class="stock-percentage">{{ getStockPercentage(item).toFixed(0) }}%</span>
              </div>
            </div>
          </td>
          <td>
            <span class="category-badge">{{ item.product_category || '-' }}</span>
          </td>
          <td>
            <div class="stock-display">
              <span class="stock-value" [class.low]="item.is_low_stock" [class.out]="item.quantity === 0">
                {{ item.quantity }}
              </span>
              <span class="stock-unit">unités</span>
            </div>
          </td>
          <td>
            <span class="min-quantity">{{ item.min_quantity || 0 }} unités</span>
          </td>
          <td>
            <span [class]="getStatusClass(item.is_low_stock ? 'low_stock' : (item.quantity === 0 ? 'out_of_stock' : 'in_stock'))">
              <span class="status-dot"></span>
              {{ getStatusLabel(item.is_low_stock ? 'low_stock' : (item.quantity === 0 ? 'out_of_stock' : 'in_stock')) }}
            </span>
          </td>
          <td class="price-cell">
            <div class="price-info" *ngIf="item.purchase_price || item.selling_price">
              <span class="price-value purchase" *ngIf="item.purchase_price">{{ item.purchase_price | currencyFormat }}</span>
              <span class="price-value selling" *ngIf="item.selling_price">{{ item.selling_price | currencyFormat }}</span>
            </div>
            <span *ngIf="!item.purchase_price && !item.selling_price" class="price-na">-</span>
          </td>
          <td>
            <div class="date-cell">
              <span class="date-value">{{ formatDate(item.updated_at) }}</span>
            </div>
          </td>
          <td>
            <div class="action-buttons">
              <a *ngIf="item.id" [routerLink]="['/inventory/detail', item.id]" class="action-btn view" title="Voir détails">
                <i class="bi bi-eye"></i>
              </a>
              <a *ngIf="item.id" [routerLink]="['/inventory/adjust', item.id]" class="action-btn edit" title="Ajuster le stock">
                <i class="bi bi-pencil"></i>
              </a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Chargement de l'inventaire...</p>
  </div>

  <div *ngIf="!isLoading && displayedInventories.length === 0" class="empty-state">
    <i class="bi bi-box" style="font-size: 64px; opacity: 0.3;"></i>
    <p>Aucun produit trouvé</p>
    <a routerLink="/inventory/create" class="btn btn-primary">Créer un inventaire</a>
  </div>
  
  <!-- Pagination -->
  <app-pagination
    *ngIf="totalItems > 0"
    [currentPage]="currentPage"
    [totalPages]="totalPages"
    [pageSize]="pageSize"
    [totalItems]="totalItems"
    (pageChange)="onPageChange($event)"
    (pageSizeChange)="onPageSizeChange($event)">
  </app-pagination>
</div>
