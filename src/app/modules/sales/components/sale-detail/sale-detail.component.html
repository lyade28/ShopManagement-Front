<div class="sale-detail-container fade-in" *ngIf="sale">
  <div class="page-header">
    <div>
      <div class="breadcrumb">
        <a routerLink="/sales">Ventes</a>
        <span>/</span>
        <span>{{ sale.sale_number || sale.id }}</span>
      </div>
      <h1>Vente #{{ sale.sale_number || sale.id }}</h1>
      <p class="subtitle">Vente du {{ sale.sale_date | date:'full' }}</p>
    </div>
    <div class="header-actions">
      <button (click)="viewInvoice()" class="btn btn-secondary" *ngIf="invoiceId">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 2v6h6l-6-6zm-2 0H4v16h12v-8h-6V2zm2 10v2h4v-2h-4zm0 4v2h4v-2h-4z" fill="currentColor"/>
        </svg>
        Voir la facture
      </button>
    </div>
  </div>

  <div class="sale-detail-grid">
    <!-- Sale Info Card -->
    <div class="sale-info-card card">
      <h3 class="card-title">Informations de la vente</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">N° Vente</span>
          <span class="info-value">{{ sale.sale_number || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Date</span>
          <span class="info-value">{{ sale.sale_date | date:'short' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Client</span>
          <span class="info-value">{{ sale.customer_name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Boutique</span>
          <span class="info-value">{{ sale.shop_name || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Vendeur</span>
          <span class="info-value">{{ sale.seller_name || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Statut</span>
          <span class="status-badge" [class]="getStatusClass(sale.status)">
            {{ getStatusLabel(sale.status) }}
          </span>
        </div>
      </div>
    </div>

    <!-- Sale Items Card -->
    <div class="sale-items-card card">
      <h3 class="card-title">Produits vendus</h3>
      <div class="items-table">
        <table>
          <thead>
            <tr>
              <th>Produit</th>
              <th>Quantité</th>
              <th>Prix unitaire</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of sale.items">
              <td>{{ item.product_name }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.unit_price | currencyFormat }}</td>
              <td class="item-total">{{ item.subtotal || item.total | currencyFormat }}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="total-row">
              <td colspan="3" class="total-label">Total</td>
              <td class="total-amount">{{ sale.total | currencyFormat }}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="loading-state" *ngIf="isLoading">
  <p>Chargement des détails de la vente...</p>
</div>
